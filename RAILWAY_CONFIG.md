# Configurações para Railway

## Variáveis de Ambiente Necessárias

Adicione as seguintes variáveis de ambiente no Railway:

### Obrigatórias

```
POSTGRES_CONNECTION_STRING=postgresql://postgres.hccolkrnyrxcbxuuajwq:1d8vUnUlDXT7cmox@aws-0-sa-east-1.pooler.supabase.com:5432/postgres
```

### Opcionais (com valores padrão)

```
# PostgreSQL
POSTGRES_TABLE_SCHEMA=busca_fornecedor
POSTGRES_TABLE_NAME=result_vllm_test

# vLLM
VLLM_URL=https://5u888x525vvzvs-8000.proxy.runpod.net
VLLM_API_KEY=buscafornecedor
VLLM_USE_V1_PATH=true

# Phoenix
PHOENIX_COLLECTOR_ENDPOINT=https://arize-phoenix-buscafornecedor.up.railway.app
PHOENIX_PROJECT_NAME=buscafornecedor-vllm

# API
API_PORT=8080
API_HOST=0.0.0.0
```

## Como Adicionar no Railway

1. Acesse seu projeto no Railway
2. Vá em **Variables**
3. Clique em **+ New Variable**
4. Adicione cada variável acima

**Importante:** A variável `POSTGRES_CONNECTION_STRING` é obrigatória. As outras têm valores padrão, mas você pode sobrescrevê-las se necessário.

## Verificação

Após configurar, você pode verificar se está tudo funcionando:

1. Acesse o endpoint `/health` - deve retornar `postgres_connected: true`
2. Faça uma requisição para `/v1/chat/completions` - deve retornar `202 Accepted`
3. Verifique a tabela no Supabase para confirmar que os dados estão sendo salvos

## Estrutura da Tabela

A tabela `busca_fornecedor.result_vllm_test` deve ter a seguinte estrutura:

```sql
create table busca_fornecedor.result_vllm_test (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  vllm_output text null,
  vllm_input text null,
  error boolean null,
  error_message text null,
  constraint result_vllm_test_pkey primary key (id)
) TABLESPACE pg_default;
```

## Comportamento da API

- **Modo Assíncrono**: A API retorna `202 Accepted` imediatamente após receber a requisição
- **Processamento em Background**: A chamada ao vLLM e o salvamento no banco acontecem em uma thread separada
- **Instrumentação Phoenix**: Todas as chamadas ao vLLM são automaticamente instrumentadas e enviadas para o Phoenix
- **Salvamento no Banco**: Os resultados (sucesso ou erro) são sempre salvos na tabela PostgreSQL
